<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>NFC Tap (Generate Token)</title>
</head>
<body>
  <div id="app">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ó‡πÄ‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà...</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    // üîß ‡πÉ‡∏™‡πà config ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const app = document.getElementById("app");

    function show(msg) {
      app.innerHTML = msg;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ó‡πÄ‡∏Ñ‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
    function generateToken() {
      return Math.random().toString(36).slice(2, 10); // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "k3f9ab1z"
    }

    async function main() {
      try {
        const token = generateToken();

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á doc ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô collection "tokens"
        // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ doc = token ‡πÄ‡∏•‡∏¢ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
        await db.collection("tokens").doc(token).set({
          used: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÅ‡∏ß‡πâ‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á (‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡∏™)
        show(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ó‡πÄ‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß: <b>${token}</b><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ secure...`);

        // ‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ secure.html ‡∏û‡∏£‡πâ‡∏≠‡∏° token
        setTimeout(() => {
          window.location.href = `https://taithai-tai.github.io/test/home?token=${encodeURIComponent(token)}`;
        }, 800);

      } catch (err) {
        console.error(err);
        show("‚ö† ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ó‡πÄ‡∏Ñ‡∏ô");
      }
    }

    main();
  </script>
</body>
</html>
